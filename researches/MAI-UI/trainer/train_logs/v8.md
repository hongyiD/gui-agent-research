unsloth@fcf2aae2e869:/workspace/mai-ui-trainer/trainer$ python sft_trainer.py --config configs/my_config_119.yaml
Skipping import of cpp extensions due to incompatible torch version 2.9.0+cu128 for torchao version 0.13.0
============================================================
Training Configuration Summary
============================================================
Model path: /workspace/MAI-UI-2B
Data path: /workspace/mai-ui-trainer/dataset/train_data/sft_train.jsonl
Output directory: /workspace/mai-ui-trainer/trainer/models/sft_model/20260202_085321
Max length: 4096
Use LoRA: True
  LoRA r: 16
  LoRA alpha: 32
  LoRA dropout: 0.1
  LoRA target modules: ['q_proj', 'k_proj', 'v_proj', 'o_proj', 'gate_proj', 'up_proj', 'down_proj']
Use 4-bit quantization: False
Gradient checkpointing: True
============================================================

GPU compute capability (7, 0), using float16 (V100 or older)
`torch_dtype` is deprecated! Use `dtype` instead!
Loaded as Qwen3VL model with multi-modal support
VL Model: True
Gradient checkpointing enabled
All model parameters frozen for LoRA training
trainable params: 17,432,576 || all params: 2,144,964,608 || trainable%: 0.8127
LoRA applied successfully
Loading dataset from: /workspace/mai-ui-trainer/dataset/train_data/sft_train.jsonl
Dataset size: 189
Sample keys: ['messages', 'metadata']
  messages: list with 3 items
    First item type: <class 'dict'>
  metadata: <class 'dict'>

Data contains images: True
Training with fp16=True (GPU does not support bfloat16, using float16)
Using MultiModalDataCollator for vision-language training (max 1 images/sample)
Image base directory: /workspace/mai-ui-trainer/dataset/train_data

============================================================
DATASET PREPROCESSING
============================================================
  Max images per sample: 1
  Total samples: 189
  Data directory: /workspace/mai-ui-trainer/dataset/train_data
Decoding images:  93%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████Decoding images:  96%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████Decoding images: 100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 189/189 [00:03<00:00, 62.82it/s]

============================================================
PREPROCESSING SUMMARY
============================================================
  Samples processed: 189
  Original images: 189 (1.0 avg/sample)
  After limiting: 189 (1.0 avg/sample)
  Avg image size: 460x1024 pixels
============================================================

Detected kernel version 3.10.0, which is below the recommended minimum of 5.5.0; this can cause the process to hang. It is recommended to upgrade the kernel to the minimum version or higher.
The model is already on multiple devices. Skipping the move to device specified in `args`.

NOTE: First step may be slow due to JIT compilation and image processing.
      Watch for detailed step-by-step logs below.

The tokenizer has new PAD/BOS/EOS tokens that differ from the model config and generation config. The model config and generation config were aligned accordingly, being updated with the tokenizer's values. Updated tokens: {'bos_token_id': None}.

======================================================================
TRAINING STARTED
======================================================================
  Total steps: 120
  Epochs: 5
  Batch size: 1
  Gradient accumulation: 8
  Effective batch size: 8
  Learning rate: 0.0001
  FP16: True, BF16: False
  Gradient checkpointing: True
  GPU: Tesla V100-SXM2-32GB
  GPU Memory: 31.7 GB total
======================================================================

  0%|                                                                                                                          | 0/120 [00:00<?, ?it/s]
--- Epoch 1/5 ---
[DEBUG] apply_chat_template: 0.06s, processor: 0.05s
[DEBUG] apply_chat_template: 0.00s, processor: 0.04s
[DEBUG] apply_chat_template: 0.00s, processor: 0.04s
[DEBUG] apply_chat_template: 0.00s, processor: 0.03s
[DEBUG] apply_chat_template: 0.00s, processor: 0.03s
[DEBUG] apply_chat_template: 0.00s, processor: 0.03s
[DEBUG] apply_chat_template: 0.00s, processor: 0.03s
[DEBUG] apply_chat_template: 0.00s, processor: 0.03s
[DEBUG] apply_chat_template: 0.00s, processor: 0.02s
[Step 1/120] time: 255.51s | VRAM: 4.3/31.7GB (13%) | ETA: 8.5h
{'loss': 0.7379, 'grad_norm': 3.3831372261047363, 'learning_rate': 0.0, 'epoch': 0.04}                                                                 
  1%|▉                                                                                                              | 1/120 [04:15<8:27:33, 255.91s/it][DEBUG] apply_chat_template: 0.00s, processor: 0.04s
[DEBUG] apply_chat_template: 0.00s, processor: 0.03s
[DEBUG] apply_chat_template: 0.00s, processor: 0.03s
[DEBUG] apply_chat_template: 0.00s, processor: 0.04s
[DEBUG] apply_chat_template: 0.00s, processor: 0.03s
[DEBUG] apply_chat_template: 0.00s, processor: 0.03s
[DEBUG] apply_chat_template: 0.00s, processor: 0.03s
[DEBUG] apply_chat_template: 0.00s, processor: 0.05s
[Step 2/120] time: 245.02s | loss: 0.7379 | lr: 0.00e+00 | VRAM: 4.3/31.7GB (13%) | ETA: 8.2h
{'loss': 0.8065, 'grad_norm': 4.156135082244873, 'learning_rate': 2e-05, 'epoch': 0.08}                                                                
  2%|█▊                                                                                                             | 2/120 [08:21<8:11:05, 249.71s/it][DEBUG] apply_chat_template: 0.00s, processor: 0.03s
[DEBUG] apply_chat_template: 0.00s, processor: 0.02s
[DEBUG] apply_chat_template: 0.00s, processor: 0.03s
[DEBUG] apply_chat_template: 0.00s, processor: 0.03s
[DEBUG] apply_chat_template: 0.00s, processor: 0.03s
[DEBUG] apply_chat_template: 0.00s, processor: 0.03s
[DEBUG] apply_chat_template: 0.00s, processor: 0.02s
[DEBUG] apply_chat_template: 0.00s, processor: 0.03s
[Step 3/120] time: 249.66s | loss: 0.8065 | lr: 2.00e-05 | VRAM: 4.3/31.7GB (13%) | ETA: 8.1h
{'loss': 0.9146, 'grad_norm': 4.803024768829346, 'learning_rate': 4e-05, 'epoch': 0.13}                                                                
  2%|██▊                                                                                                            | 3/120 [12:31<8:07:07, 249.81s/it][DEBUG] apply_chat_template: 0.00s, processor: 0.04s
[DEBUG] apply_chat_template: 0.00s, processor: 0.03s
[DEBUG] apply_chat_template: 0.00s, processor: 0.03s
[DEBUG] apply_chat_template: 0.00s, processor: 0.03s
[DEBUG] apply_chat_template: 0.00s, processor: 0.03s
[DEBUG] apply_chat_template: 0.00s, processor: 0.03s
[DEBUG] apply_chat_template: 0.00s, processor: 0.02s
[DEBUG] apply_chat_template: 0.00s, processor: 0.03s
[Step 4/120] time: 250.45s | loss: 0.9146 | lr: 4.00e-05 | VRAM: 4.3/31.7GB (13%) | ETA: 8.1h
{'loss': 0.5531, 'grad_norm': 2.2774691581726074, 'learning_rate': 6e-05, 'epoch': 0.17}                                                               
  3%|███▋                                                                                                           | 4/120 [16:41<8:03:40, 250.17s/it][DEBUG] apply_chat_template: 0.00s, processor: 0.03s
[DEBUG] apply_chat_template: 0.00s, processor: 0.03s
[DEBUG] apply_chat_template: 0.00s, processor: 0.02s
[DEBUG] apply_chat_template: 0.00s, processor: 0.03s
[DEBUG] apply_chat_template: 0.00s, processor: 0.02s
[DEBUG] apply_chat_template: 0.00s, processor: 0.03s
[DEBUG] apply_chat_template: 0.00s, processor: 0.02s
[DEBUG] apply_chat_template: 0.00s, processor: 0.03s
[Step 5/120] time: 243.66s | loss: 0.5531 | lr: 6.00e-05 | VRAM: 4.3/31.7GB (13%) | ETA: 8.0h
{'loss': 0.5974, 'grad_norm': 1.573167085647583, 'learning_rate': 8e-05, 'epoch': 0.21}                                                                
  4%|████▋                                                                                                          | 5/120 [20:45<7:55:10, 247.92s/it][DEBUG] apply_chat_template: 0.00s, processor: 0.03s
[DEBUG] apply_chat_template: 0.00s, processor: 0.04s
[DEBUG] apply_chat_template: 0.00s, processor: 0.02s
[DEBUG] apply_chat_template: 0.00s, processor: 0.03s
[DEBUG] apply_chat_template: 0.00s, processor: 0.03s
[DEBUG] apply_chat_template: 0.00s, processor: 0.03s
[DEBUG] apply_chat_template: 0.00s, processor: 0.03s
[DEBUG] apply_chat_template: 0.00s, processor: 0.03s
[Step 6/120] time: 249.26s | loss: 0.5974 | lr: 8.00e-05 | VRAM: 4.3/31.7GB (13%) | ETA: 7.9h
{'loss': 0.593, 'grad_norm': 1.4065805673599243, 'learning_rate': 0.0001, 'epoch': 0.25}                                                               
  5%|█████▌                                                                                                         | 6/120 [24:56<7:52:46, 248.83s/it][DEBUG] apply_chat_template: 0.00s, processor: 0.03s
[DEBUG] apply_chat_template: 0.00s, processor: 0.02s
[DEBUG] apply_chat_template: 0.00s, processor: 0.02s
[DEBUG] apply_chat_template: 0.00s, processor: 0.03s
[DEBUG] apply_chat_template: 0.00s, processor: 0.03s
[DEBUG] apply_chat_template: 0.00s, processor: 0.02s
[DEBUG] apply_chat_template: 0.00s, processor: 0.02s
[DEBUG] apply_chat_template: 0.00s, processor: 0.03s
[Step 7/120] time: 245.02s | loss: 0.5930 | lr: 1.00e-04 | VRAM: 4.3/31.7GB (13%) | ETA: 7.8h
{'loss': 0.4478, 'grad_norm': 1.3978686332702637, 'learning_rate': 9.91304347826087e-05, 'epoch': 0.3}                                                 
  6%|██████▍                                                                                                        | 7/120 [29:01<7:46:27, 247.67s/it][DEBUG] apply_chat_template: 0.00s, processor: 0.03s
[DEBUG] apply_chat_template: 0.00s, processor: 0.05s
[DEBUG] apply_chat_template: 0.00s, processor: 0.03s
[DEBUG] apply_chat_template: 0.00s, processor: 0.02s
[DEBUG] apply_chat_template: 0.00s, processor: 0.03s
[DEBUG] apply_chat_template: 0.00s, processor: 0.02s
[DEBUG] apply_chat_template: 0.00s, processor: 0.03s
[DEBUG] apply_chat_template: 0.00s, processor: 0.03s
[Step 8/120] time: 255.25s | loss: 0.4478 | lr: 9.91e-05 | VRAM: 4.3/31.7GB (13%) | ETA: 7.8h
{'loss': 0.3156, 'grad_norm': 0.7722050547599792, 'learning_rate': 9.82608695652174e-05, 'epoch': 0.34}                                                
  7%|███████▍                                                                                                       | 8/120 [33:17<7:46:59, 250.18s/it][DEBUG] apply_chat_template: 0.00s, processor: 0.03s
[DEBUG] apply_chat_template: 0.00s, processor: 0.02s
[DEBUG] apply_chat_template: 0.00s, processor: 0.02s
[DEBUG] apply_chat_template: 0.00s, processor: 0.03s
[DEBUG] apply_chat_template: 0.00s, processor: 0.03s
[DEBUG] apply_chat_template: 0.00s, processor: 0.03s
[DEBUG] apply_chat_template: 0.00s, processor: 0.03s
[DEBUG] apply_chat_template: 0.00s, processor: 0.03s
[Step 9/120] time: 254.92s | loss: 0.3156 | lr: 9.83e-05 | VRAM: 4.3/31.7GB (13%) | ETA: 7.7h
{'loss': 0.4881, 'grad_norm': 0.733481228351593, 'learning_rate': 9.739130434782609e-05, 'epoch': 0.38}                                                
  8%|████████▎                                                                                                      | 9/120 [37:32<7:45:43, 251.74s/it][DEBUG] apply_chat_template: 0.00s, processor: 0.03s
[DEBUG] apply_chat_template: 0.00s, processor: 0.02s
[DEBUG] apply_chat_template: 0.00s, processor: 0.03s
[DEBUG] apply_chat_template: 0.00s, processor: 0.03s
[DEBUG] apply_chat_template: 0.00s, processor: 0.02s
[DEBUG] apply_chat_template: 0.00s, processor: 0.02s
[DEBUG] apply_chat_template: 0.00s, processor: 0.03s
[DEBUG] apply_chat_template: 0.00s, processor: 0.02s
[Step 10/120] time: 250.41s | loss: 0.4881 | lr: 9.74e-05 | VRAM: 4.3/31.7GB (13%) | ETA: 7.6h
{'loss': 0.4041, 'grad_norm': 0.7240191102027893, 'learning_rate': 9.652173913043479e-05, 'epoch': 0.42}                                               
  8%|█████████▏                                                                                                    | 10/120 [41:43<7:40:55, 251.41s/it][DEBUG] apply_chat_template: 0.00s, processor: 0.02s
[DEBUG] apply_chat_template: 0.00s, processor: 0.02s
[DEBUG] apply_chat_template: 0.00s, processor: 0.02s
[DEBUG] apply_chat_template: 0.00s, processor: 0.03s
[DEBUG] apply_chat_template: 0.00s, processor: 0.03s
[DEBUG] apply_chat_template: 0.00s, processor: 0.03s
[DEBUG] apply_chat_template: 0.00s, processor: 0.03s
[DEBUG] apply_chat_template: 0.00s, processor: 0.02s
[Step 11/120] time: 255.90s | loss: 0.4041 | lr: 9.65e-05 | VRAM: 4.3/31.7GB (13%) | ETA: 7.6h
{'loss': 0.4838, 'grad_norm': 0.8533298373222351, 'learning_rate': 9.565217391304348e-05, 'epoch': 0.47}                                               
  9%|██████████                                                                                                    | 11/120 [46:00<7:39:56, 253.18s/it][DEBUG] apply_chat_template: 0.00s, processor: 0.03s
[DEBUG] apply_chat_template: 0.00s, processor: 0.02s
[DEBUG] apply_chat_template: 0.00s, processor: 0.03s
[DEBUG] apply_chat_template: 0.00s, processor: 0.03s
[DEBUG] apply_chat_template: 0.00s, processor: 0.04s
[DEBUG] apply_chat_template: 0.00s, processor: 0.03s
[DEBUG] apply_chat_template: 0.00s, processor: 0.03s
[DEBUG] apply_chat_template: 0.00s, processor: 0.03s
[Step 12/120] time: 256.20s | loss: 0.4838 | lr: 9.57e-05 | VRAM: 4.3/31.7GB (13%) | ETA: 7.5h
{'loss': 0.3862, 'grad_norm': 0.6868597269058228, 'learning_rate': 9.478260869565218e-05, 'epoch': 0.51}                                               
 10%|███████████                                                                                                   | 12/120 [50:16<7:37:32, 254.19s/it][DEBUG] apply_chat_template: 0.00s, processor: 0.03s
[DEBUG] apply_chat_template: 0.00s, processor: 0.03s
[DEBUG] apply_chat_template: 0.00s, processor: 0.03s
[DEBUG] apply_chat_template: 0.00s, processor: 0.03s
[DEBUG] apply_chat_template: 0.00s, processor: 0.03s
[DEBUG] apply_chat_template: 0.00s, processor: 0.03s
[DEBUG] apply_chat_template: 0.00s, processor: 0.02s
[DEBUG] apply_chat_template: 0.00s, processor: 0.04s
[Step 13/120] time: 255.87s | loss: 0.3862 | lr: 9.48e-05 | VRAM: 4.3/31.7GB (13%) | ETA: 7.5h
{'loss': 0.3538, 'grad_norm': 0.6786190271377563, 'learning_rate': 9.391304347826087e-05, 'epoch': 0.55}                                               
 11%|███████████▉                                                                                                  | 13/120 [54:32<7:34:22, 254.79s/it][DEBUG] apply_chat_template: 0.00s, processor: 0.02s
[DEBUG] apply_chat_template: 0.00s, processor: 0.03s
[DEBUG] apply_chat_template: 0.00s, processor: 0.03s
[DEBUG] apply_chat_template: 0.00s, processor: 0.02s
[DEBUG] apply_chat_template: 0.00s, processor: 0.02s
[DEBUG] apply_chat_template: 0.00s, processor: 0.03s
[DEBUG] apply_chat_template: 0.00s, processor: 0.02s
[DEBUG] apply_chat_template: 0.00s, processor: 0.03s
[Step 14/120] time: 257.43s | loss: 0.3538 | lr: 9.39e-05 | VRAM: 4.3/31.7GB (13%) | ETA: 7.4h
{'loss': 0.3661, 'grad_norm': 0.7673922777175903, 'learning_rate': 9.304347826086957e-05, 'epoch': 0.59}                                               
 12%|████████████▊                                                                                                 | 14/120 [58:50<7:31:40, 255.67s/it][DEBUG] apply_chat_template: 0.00s, processor: 0.03s
[DEBUG] apply_chat_template: 0.00s, processor: 0.02s
[DEBUG] apply_chat_template: 0.00s, processor: 0.03s
[DEBUG] apply_chat_template: 0.00s, processor: 0.03s
[DEBUG] apply_chat_template: 0.00s, processor: 0.02s
[DEBUG] apply_chat_template: 0.00s, processor: 0.02s
[DEBUG] apply_chat_template: 0.00s, processor: 0.03s
[DEBUG] apply_chat_template: 0.00s, processor: 0.02s
[Step 15/120] time: 248.52s | loss: 0.3661 | lr: 9.30e-05 | VRAM: 4.3/31.7GB (13%) | ETA: 7.3h
{'loss': 0.5083, 'grad_norm': 0.7619128823280334, 'learning_rate': 9.217391304347827e-05, 'epoch': 0.63}                                               
 12%|█████████████▌                                                                                              | 15/120 [1:02:59<7:23:46, 253.59s/it][DEBUG] apply_chat_template: 0.00s, processor: 0.02s
[DEBUG] apply_chat_template: 0.00s, processor: 0.03s
[DEBUG] apply_chat_template: 0.00s, processor: 0.02s
[DEBUG] apply_chat_template: 0.00s, processor: 0.02s
[DEBUG] apply_chat_template: 0.00s, processor: 0.03s
[DEBUG] apply_chat_template: 0.00s, processor: 0.03s
[DEBUG] apply_chat_template: 0.00s, processor: 0.02s
[DEBUG] apply_chat_template: 0.00s, processor: 0.03s
[Step 16/120] time: 249.15s | loss: 0.5083 | lr: 9.22e-05 | VRAM: 4.3/31.7GB (13%) | ETA: 7.3h
{'loss': 0.4756, 'grad_norm': 0.8387991786003113, 'learning_rate': 9.130434782608696e-05, 'epoch': 0.68}                                               
 13%|██████████████▍                                                                                             | 16/120 [1:07:10<7:17:58, 252.68s/it][DEBUG] apply_chat_template: 0.00s, processor: 0.03s
[DEBUG] apply_chat_template: 0.00s, processor: 0.03s
[DEBUG] apply_chat_template: 0.00s, processor: 0.03s
[DEBUG] apply_chat_template: 0.00s, processor: 0.03s
[DEBUG] apply_chat_template: 0.00s, processor: 0.03s
[DEBUG] apply_chat_template: 0.00s, processor: 0.03s
[DEBUG] apply_chat_template: 0.00s, processor: 0.02s
[DEBUG] apply_chat_template: 0.00s, processor: 0.03s
[Step 17/120] time: 251.52s | loss: 0.4756 | lr: 9.13e-05 | VRAM: 4.3/31.7GB (13%) | ETA: 7.2h
{'loss': 0.4719, 'grad_norm': 0.736143946647644, 'learning_rate': 9.043478260869566e-05, 'epoch': 0.72}                                                
 14%|███████████████▎                                                                                            | 17/120 [1:11:21<7:13:18, 252.41s/it][DEBUG] apply_chat_template: 0.00s, processor: 0.02s
[DEBUG] apply_chat_template: 0.00s, processor: 0.02s
[DEBUG] apply_chat_template: 0.00s, processor: 0.03s
[DEBUG] apply_chat_template: 0.00s, processor: 0.03s
[DEBUG] apply_chat_template: 0.00s, processor: 0.02s
[DEBUG] apply_chat_template: 0.00s, processor: 0.03s
[DEBUG] apply_chat_template: 0.00s, processor: 0.03s
[DEBUG] apply_chat_template: 0.00s, processor: 0.02s
[Step 18/120] time: 246.15s | loss: 0.4719 | lr: 9.04e-05 | VRAM: 4.3/31.7GB (13%) | ETA: 7.1h
{'loss': 0.4195, 'grad_norm': 0.7483424544334412, 'learning_rate': 8.956521739130435e-05, 'epoch': 0.76}                                               
 15%|████████████████▏                                                                                           | 18/120 [1:15:28<7:06:02, 250.61s/it][DEBUG] apply_chat_template: 0.00s, processor: 0.03s
[DEBUG] apply_chat_template: 0.00s, processor: 0.03s
[DEBUG] apply_chat_template: 0.00s, processor: 0.03s
[DEBUG] apply_chat_template: 0.00s, processor: 0.03s
[DEBUG] apply_chat_template: 0.00s, processor: 0.02s
[DEBUG] apply_chat_template: 0.00s, processor: 0.02s
[DEBUG] apply_chat_template: 0.00s, processor: 0.02s
[DEBUG] apply_chat_template: 0.00s, processor: 0.03s
[Step 19/120] time: 248.49s | loss: 0.4195 | lr: 8.96e-05 | VRAM: 4.3/31.7GB (13%) | ETA: 7.1h
{'loss': 0.375, 'grad_norm': 0.6929658651351929, 'learning_rate': 8.869565217391305e-05, 'epoch': 0.8}                                                 
 16%|█████████████████                                                                                           | 19/120 [1:19:37<7:00:55, 250.06s/it][DEBUG] apply_chat_template: 0.00s, processor: 0.03s
[DEBUG] apply_chat_template: 0.00s, processor: 0.02s
[DEBUG] apply_chat_template: 0.00s, processor: 0.02s
[DEBUG] apply_chat_template: 0.00s, processor: 0.04s
[DEBUG] apply_chat_template: 0.00s, processor: 0.03s
[DEBUG] apply_chat_template: 0.00s, processor: 0.02s
[DEBUG] apply_chat_template: 0.00s, processor: 0.02s
[DEBUG] apply_chat_template: 0.00s, processor: 0.03s
[Step 20/120] time: 249.24s | loss: 0.3750 | lr: 8.87e-05 | VRAM: 4.3/31.7GB (13%) | ETA: 7.0h
{'loss': 0.3691, 'grad_norm': 0.6921398639678955, 'learning_rate': 8.782608695652174e-05, 'epoch': 0.85}                                               
 17%|██████████████████                                                                                          | 20/120 [1:23:46<6:56:29, 249.89s/it][DEBUG] apply_chat_template: 0.00s, processor: 0.02s
[DEBUG] apply_chat_template: 0.00s, processor: 0.03s
[DEBUG] apply_chat_template: 0.00s, processor: 0.03s
[DEBUG] apply_chat_template: 0.00s, processor: 0.02s
[DEBUG] apply_chat_template: 0.00s, processor: 0.03s
[DEBUG] apply_chat_template: 0.00s, processor: 0.03s
[DEBUG] apply_chat_template: 0.00s, processor: 0.02s
[DEBUG] apply_chat_template: 0.00s, processor: 0.03s